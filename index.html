<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplication Table</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50%' y='50%' font-size='60' text-anchor='middle' dominant-baseline='middle'>9√ó9</text></svg>">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            color: #0066cc;
        }
        .logo {
            font-size: 48px;
            margin: 10px 0;
            font-weight: bold;
        }
        .language-switcher {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
        }
        .language-btn {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            color: #0066cc;
        }
        .language-btn.active {
            background: #0066cc;
            color: white;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
            flex-grow: 1;
        }
        .grid-btn {
            aspect-ratio: 1;
            font-size: 24px;
            border: none;
            border-radius: 15px;
            background-color: white;
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0066cc;
        }
        .grid-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            background-color: #e6f0ff;
        }
        .grid-btn:active {
            transform: translateY(0);
        }
        .back-btn {
            padding: 10px 20px;
            font-size: 18px;
            border: none;
            border-radius: 10px;
            background-color: #e6f0ff;
            cursor: pointer;
            margin: 20px 0;
            color: #0066cc;
        }
        .screen {
            display: none;
            flex-direction: column;
            flex-grow: 1;
        }
        .active {
            display: flex;
        }
        .current-table {
            font-size: 24px;
            margin: 10px 0;
        }
        footer {
            margin-top: auto;
            padding: 20px 0;
            font-size: 14px;
        }
        .email-link {
            color: #0066cc;
            text-decoration: none;
        }
        .sound-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #0066cc;
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #question-display {
            font-size: 48px;
            margin: 30px 0;
        }
        #correct-answer {
            font-size: 72px;
            color: #0066cc;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <!-- Ë®ÄË™û„Çπ„Ç§„ÉÉ„ÉÅ„É£„Éº -->
    <div class="language-switcher">
        <button class="language-btn active" data-lang="en">English</button>
        <button class="language-btn" data-lang="zh">‰∏≠Êñá</button>
        <button class="language-btn" data-lang="ja">Êó•Êú¨Ë™û</button>
    </div>

    <!-- ÊÆµÈÅ∏ÊäûÁîªÈù¢ -->
    <div class="screen active" id="menu-screen">
        <div class="logo">9√ó9</div>
        <div class="current-table" id="menu-title">Select a table</div>
        <div class="grid-container" id="table-grid">
            <!-- 1-9„ÅÆÊï∞Â≠ó„Éú„Çø„É≥„Åå„Åì„Åì„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
        </div>
    </div>

    <!-- ÂïèÈ°åÈÅ∏ÊäûÁîªÈù¢ -->
    <div class="screen" id="problem-screen">
        <div class="logo">9√ó9</div>
        <div class="current-table" id="current-table-display"></div>
        <div class="grid-container" id="problem-grid">
            <!-- ÂïèÈ°å„Éú„Çø„É≥„Åå„Åì„Åì„Å´ÁîüÊàê„Åï„Çå„Åæ„Åô -->
        </div>
        <button class="back-btn" id="back-to-menu">‚Üê</button>
    </div>

    <!-- Á≠î„ÅàË°®Á§∫ÁîªÈù¢ -->
    <div class="screen" id="answer-screen">
        <div class="logo">9√ó9</div>
        <div class="current-table" id="answer-table-display"></div>
        <div id="question-display"></div>
        <div id="correct-answer"></div>
        <button class="back-btn" id="back-to-problem">‚Üê</button>
    </div>

    <!-- Èü≥Â£∞„Éú„Çø„É≥ -->
    <button class="sound-btn" id="sound-btn">üîä</button>

    <footer>
        <span id="contact-text">Contact us</span><br>
        <a href="mailto:mementomorikatsu@gmail.com" class="email-link">mementomorikatsu@gmail.com</a>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Â§öË®ÄË™ûÂØæÂøú„ÉÜ„Ç≠„Çπ„Éà
            const translations = {
                en: {
                    menuTitle: "Select a table",
                    back: "Back",
                    contact: "Contact us",
                    tableTitle: "Times Table"
                },
                zh: {
                    menuTitle: "ÈÄâÊã©‰πòÊ≥ïË°®",
                    back: "ËøîÂõû",
                    contact: "ËÅîÁ≥ªÊàë‰ª¨",
                    tableTitle: "‰πòÊ≥ïË°®"
                },
                ja: {
                    menuTitle: "ÊÆµ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ",
                    back: "Êàª„Çã",
                    contact: "„ÅäÂïè„ÅÑÂêà„Çè„Åõ",
                    tableTitle: "„ÅÆÊÆµ"
                }
            };

            // Êï∞Â≠ó„ÅÆÂ§öË®ÄË™ûË°®ÁèæÔºà‰∏≠ÂõΩË™û„Çí‰øÆÊ≠£Ôºâ
            const numberTexts = {
                en: ["zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine"],
                zh: ["Èõ∂", "‰∏Ä", "‰∫å", "‰∏â", "Âõõ", "‰∫î", "ÂÖ≠", "‰∏É", "ÂÖ´", "‰πù"],
                ja: ["„Äá", "‰∏Ä", "‰∫å", "‰∏â", "Âõõ", "‰∫î", "ÂÖ≠", "‰∏É", "ÂÖ´", "‰πù"]
            };

            // ÁèæÂú®„ÅÆË®ÄË™û („Éá„Éï„Ç©„É´„Éà„ÅØËã±Ë™û)
            let currentLang = 'en';
            
            // Èü≥Â£∞ÂêàÊàêË®≠ÂÆö
            const synth = window.speechSynthesis;
            let voices = [];
            let voice = null;

            // Èü≥Â£∞„ÅÆÊ∫ñÂÇôÔºà„Çà„ÇäÈÅ©Âàá„Å™Èü≥Â£∞„ÇíÈÅ∏Êäû„Åô„Çã„Çà„ÅÜ„Å´ÊîπËâØÔºâ
            function loadVoices() {
                return new Promise(resolve => {
                    voices = synth.getVoices();
                    if (voices.length > 0) {
                        resolve();
                        return;
                    }
                    
                    synth.onvoiceschanged = () => {
                        voices = synth.getVoices();
                        resolve();
                    };
                });
            }

            // ÊúÄÈÅ©„Å™Èü≥Â£∞„ÇíÈÅ∏Êäû
            function selectVoice() {
                // Ëã±Ë™û„ÅÆÂÑ™ÂÖàÈ†Ü‰Ωç
                const enPriority = [
                    'en-US', 'en-GB', 'en-AU', 'en-CA', 'en-IN',
                    'en-US-Standard-A', 'en-US-Standard-B', 'en-US-Standard-C', 'en-US-Standard-D'
                ];
                
                // ‰∏≠ÂõΩË™û„ÅÆÂÑ™ÂÖàÈ†Ü‰Ωç
                const zhPriority = [
                    'zh-CN', 'zh-TW', 'zh-HK', 
                    'cmn-CN-Standard-A', 'cmn-CN-Standard-B', 'cmn-CN-Standard-C',
                    'cmn-TW-Standard-A', 'cmn-TW-Standard-B', 'cmn-TW-Standard-C'
                ];
                
                // Êó•Êú¨Ë™û„ÅÆÂÑ™ÂÖàÈ†Ü‰Ωç
                const jaPriority = [
                    'ja-JP', 'ja-JP-Standard-A', 'ja-JP-Standard-B', 'ja-JP-Standard-C'
                ];
                
                let priorityList = [];
                
                if (currentLang === 'ja') {
                    priorityList = jaPriority;
                } else if (currentLang === 'zh') {
                    priorityList = zhPriority;
                } else {
                    priorityList = enPriority;
                }
                
                // ÂÑ™ÂÖàÈ†Ü‰Ωç„Å´Âæì„Å£„Å¶Èü≥Â£∞„ÇíÊé¢„Åô
                for (const lang of priorityList) {
                    const foundVoice = voices.find(v => v.lang === lang || v.voiceURI.includes(lang));
                    if (foundVoice) {
                        voice = foundVoice;
                        return;
                    }
                }
                
                // ÈÅ©Âàá„Å™Èü≥Â£∞„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØÊúÄÂàù„ÅÆÈü≥Â£∞„Çí‰ΩøÁî®
                if (voices.length > 0) {
                    voice = voices[0];
                }
            }

            // „ÉÜ„Ç≠„Çπ„Éà„ÇíÈü≥Â£∞„ÅßË™≠„Åø‰∏ä„Åí„ÇãÔºàË®ÄË™û„Åî„Å®„Å´ÊúÄÈÅ©„Å™Ë°®Áèæ„Çí‰ΩøÁî®Ôºâ
            function speak(text) {
                if (synth.speaking) {
                    synth.cancel();
                }

                if (text && voice) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.voice = voice;
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    
                    // Ë®ÄË™û„Åî„Å®„ÅÆË™øÊï¥
                    if (currentLang === 'en') {
                        utterance.rate = 0.95; // Ëã±Ë™û„ÅØÂ∞ë„Åó„ÇÜ„Å£„Åè„Çä
                        utterance.text = text.replace(/times/g, "multiplied by").replace(/is/g, "equals");
                    } else if (currentLang === 'zh') {
                        utterance.rate = 1.0; // ‰∏≠ÂõΩË™û„ÅØÊ®ôÊ∫ñÈÄüÂ∫¶
                    } else {
                        utterance.rate = 1.0; // Êó•Êú¨Ë™û„ÅØÊ®ôÊ∫ñÈÄüÂ∫¶
                    }
                    
                    synth.speak(utterance);
                }
            }

            // Ë¶ÅÁ¥†ÂèñÂæó
            const menuScreen = document.getElementById('menu-screen');
            const problemScreen = document.getElementById('problem-screen');
            const answerScreen = document.getElementById('answer-screen');
            const tableGrid = document.getElementById('table-grid');
            const problemGrid = document.getElementById('problem-grid');
            const currentTableDisplay = document.getElementById('current-table-display');
            const answerTableDisplay = document.getElementById('answer-table-display');
            const questionDisplay = document.getElementById('question-display');
            const correctAnswer = document.getElementById('correct-answer');
            const backToMenuBtn = document.getElementById('back-to-menu');
            const backToProblemBtn = document.getElementById('back-to-problem');
            const menuTitle = document.getElementById('menu-title');
            const contactText = document.getElementById('contact-text');
            const soundBtn = document.getElementById('sound-btn');
            const languageBtns = document.querySelectorAll('.language-btn');

            // Ë®ÄË™ûÂàá„ÇäÊõø„Åà
            languageBtns.forEach(btn => {
                btn.addEventListener('click', async function() {
                    currentLang = this.dataset.lang;
                    
                    // „Éú„Çø„É≥„ÅÆactiveÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                    languageBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Èü≥Â£∞„ÇíÂÜçÈÅ∏Êäû
                    await loadVoices();
                    selectVoice();
                    
                    // UI„ÉÜ„Ç≠„Çπ„Éà„ÇíÊõ¥Êñ∞
                    updateUITexts();
                    
                    // ÁèæÂú®„ÅÆÁîªÈù¢„Å´Âøú„Åò„Å¶„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÂÜçÁîüÊàê
                    if (menuScreen.classList.contains('active')) {
                        generateTableButtons();
                    } else if (problemScreen.classList.contains('active')) {
                        const table = parseInt(currentTableDisplay.textContent.split('√ó')[0].trim());
                        showProblemScreen(table);
                    }
                });
            });

            // UI„ÉÜ„Ç≠„Çπ„Éà„ÇíÊõ¥Êñ∞
            function updateUITexts() {
                menuTitle.textContent = translations[currentLang].menuTitle;
                backToMenuBtn.textContent = translations[currentLang].back;
                backToProblemBtn.textContent = translations[currentLang].back;
                contactText.textContent = translations[currentLang].contact;
            }

            // ÊÆµÈÅ∏Êäû„Éú„Çø„É≥ÁîüÊàê („Ç∑„É≥„Éó„É´„Å™1-9„ÅÆÊï∞Â≠ó)
            function generateTableButtons() {
                tableGrid.innerHTML = '';
                
                for (let i = 1; i <= 9; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'grid-btn';
                    btn.textContent = i; // „Ç∑„É≥„Éó„É´„Å´Êï∞Â≠ó„ÅÆ„ÅøË°®Á§∫
                    btn.dataset.table = i;
                    btn.addEventListener('click', function() {
                        const table = parseInt(this.dataset.table);
                        showProblemScreen(table);
                    });
                    tableGrid.appendChild(btn);
                }
            }

            // ÂïèÈ°åÈÅ∏ÊäûÁîªÈù¢„ÇíË°®Á§∫
            function showProblemScreen(table) {
                let tableText = '';
                if (currentLang === 'ja') {
                    tableText = `${numberTexts.ja[table]}${translations.ja.tableTitle}`;
                } else if (currentLang === 'zh') {
                    tableText = `${numberTexts.zh[table]}${translations.zh.tableTitle}`;
                } else {
                    tableText = `${numberTexts.en[table]} ${translations.en.tableTitle}`;
                }
                
                currentTableDisplay.textContent = tableText;
                problemGrid.innerHTML = '';
                
                // ÂïèÈ°å„Éú„Çø„É≥ÁîüÊàê (√ó1„Åã„Çâ√ó9)
                for (let i = 1; i <= 9; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'grid-btn';
                    btn.textContent = `${table}√ó${i}`; // ÂïèÈ°åÂΩ¢Âºè„ÅßË°®Á§∫
                    btn.dataset.multiplier = i;
                    btn.addEventListener('click', function() {
                        const multiplier = parseInt(this.dataset.multiplier);
                        showAnswerScreen(table, multiplier);
                    });
                    problemGrid.appendChild(btn);
                }
                
                menuScreen.classList.remove('active');
                answerScreen.classList.remove('active');
                problemScreen.classList.add('active');
            }
            
            // Á≠î„ÅàË°®Á§∫ÁîªÈù¢„ÇíË°®Á§∫
            function showAnswerScreen(table, multiplier) {
                let tableText = '';
                if (currentLang === 'ja') {
                    tableText = `${numberTexts.ja[table]}${translations.ja.tableTitle}`;
                } else if (currentLang === 'zh') {
                    tableText = `${numberTexts.zh[table]}${translations.zh.tableTitle}`;
                } else {
                    tableText = `${numberTexts.en[table]} ${translations.en.tableTitle}`;
                }
                
                answerTableDisplay.textContent = tableText;
                questionDisplay.textContent = `${table} √ó ${multiplier} = ?`;
                correctAnswer.textContent = table * multiplier;
                
                // Èü≥Â£∞„ÅßÂïèÈ°å„Å®Á≠î„Åà„ÇíË™≠„Åø‰∏ä„ÅíÔºàË®ÄË™û„Åî„Å®„Å´ÊúÄÈÅ©„Å™Ë°®Áèæ„Çí‰ΩøÁî®Ôºâ
                if (currentLang === 'ja') {
                    speak(`${table} „Åã„Åë„Çã ${multiplier} „ÅØ ${table * multiplier}`);
                } else if (currentLang === 'zh') {
                    // ‰∏≠ÂõΩË™û„ÅÆÊ≠£„Åó„ÅÑ‰πóÁÆóË°®Áèæ (‰æã: 3 √ó 4 = 12 ‚Üí "‰∏â ‰πò‰ª• Âõõ Á≠â‰∫é ÂçÅ‰∫å")
                    const chineseAnswer = convertToChineseNumber(table * multiplier);
                    speak(`${numberTexts.zh[table]} ‰πò‰ª• ${numberTexts.zh[multiplier]} Á≠â‰∫é ${chineseAnswer}`);
                } else {
                    // Ëã±Ë™û„ÅÆ„Çà„ÇäËá™ÁÑ∂„Å™Ë°®Áèæ ("times" ‚Üí "multiplied by", "is" ‚Üí "equals")
                    speak(`${table} multiplied by ${multiplier} equals ${table * multiplier}`);
                }
                
                problemScreen.classList.remove('active');
                menuScreen.classList.remove('active');
                answerScreen.classList.add('active');
            }
            
            // Êï∞Â≠ó„Çí‰∏≠ÂõΩË™û„ÅÆË™≠„ÅøÊñπ„Å´Â§âÊèõÔºà10‰ª•‰∏ä„ÅÆÊï∞ÂÄ§ÂØæÂøúÔºâ
            function convertToChineseNumber(num) {
                if (num < 10) return numberTexts.zh[num];
                
                const units = ['', 'ÂçÅ', 'Áôæ', 'ÂçÉ'];
                let result = '';
                let digit = 0;
                
                while (num > 0) {
                    const current = num % 10;
                    if (current !== 0) {
                        // 10„ÅØ„ÄåÂçÅ„Äç„ÄÅ20„ÅØ„Äå‰∫åÂçÅ„Äç„Å®Ë°®Áèæ
                        if (digit === 1 && current === 1 && num < 100) {
                            result = units[digit] + result;
                        } else {
                            result = numberTexts.zh[current] + units[digit] + result;
                        }
                    }
                    num = Math.floor(num / 10);
                    digit++;
                }
                
                return result;
            }
            
            // Êàª„Çã„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà
            backToMenuBtn.addEventListener('click', function() {
                problemScreen.classList.remove('active');
                answerScreen.classList.remove('active');
                menuScreen.classList.add('active');
            });
            
            backToProblemBtn.addEventListener('click', function() {
                const table = parseInt(answerTableDisplay.textContent.split('√ó')[0]);
                answerScreen.classList.remove('active');
                problemScreen.classList.add('active');
            });

            // Èü≥Â£∞„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„Éà
            soundBtn.addEventListener('click', function() {
                if (answerScreen.classList.contains('active')) {
                    const table = parseInt(answerTableDisplay.textContent.split('√ó')[0]);
                    const multiplier = parseInt(questionDisplay.textContent.split('√ó')[1].split('=')[0].trim());
                    
                    if (currentLang === 'ja') {
                        speak(`${table} „Åã„Åë„Çã ${multiplier} „ÅØ ${table * multiplier}`);
                    } else if (currentLang === 'zh') {
                        const chineseAnswer = convertToChineseNumber(table * multiplier);
                        speak(`${numberTexts.zh[table]} ‰πò‰ª• ${numberTexts.zh[multiplier]} Á≠â‰∫é ${chineseAnswer}`);
                    } else {
                        speak(`${table} multiplied by ${multiplier} equals ${table * multiplier}`);
                    }
                }
            });

            // ÂàùÊúüÂåñ
            (async function() {
                await loadVoices();
                selectVoice();
                generateTableButtons();
                updateUITexts();
            })();
        });
    </script>
</body>
</html>